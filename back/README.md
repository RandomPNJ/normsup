Boilerplate Back JS
================

# DB?

## No DB at all?

1. Delete `./server/config/couchdb`, `./server/config/sqldb` and `./server/config/repositories` folders
2. Remove `cloudant`, `pg-promise` and `redis` from package.json
3. Remove `sqlDB`, `couchDB`, `ramDB`, `redisDB` and `initRepositories` `./server/app.js` and `./server/app.spec.js` snippets
4. Remove `./server/config/environment/index.js` `sqlDB`, `couchDB` and `redisDB` config sections
5. Remove `./server/config/environment/staticConfig.js` `repositories` config section

## One DB or more?

1. Delete unused DB folders in `./server/config/` folder
2.1 Remove `pg-promise` from `package.json` if not using sqlDB
2.2 Remove `cloudant` from `package.json` if not using couchDB
2.1 Remove `redis` from `package.json` if not using redisDB
3. Remove unused DB `./server/app.js` snippets
4. Activate your DBs and `using a DB` snippets in `./server/app.js` and `./server/app.spec.js`
5. Remove `./server/config/environment/index.js` unused DB config section
5.1 For sqlDB, use `toUrl` from `./credentials` for path (prefixing with 'postgre'))
5.2 For ramDB, no config section
6. Set `./server/config/environment/index.js` used DB config section
7. Set `./server/config/environment/staticConfig.js` `repositories` config section

# AMQP?

## No AMQP

1. Delete `./server/config/amqp` folder
2. Delete `./server/config/amqp.js` example file
3. Remove `./server/config/environment/index.js` `amqp` config section
4. Remove `amqp` `./server/app.js` and `./server/app.spec.js` snippets
5. Remove `amqplib` from `package.json`

## AMQP

1. Set `./server/config/environment/index.js` `amqp` config section
2. Customize your `./server/config/amqp.js` file
3. Activate `startAllMQ` and `stopAllMQ` `./server/app.js` and `./server/app.spec.js` snippets

# API?

## No API

1. Remove `./server/config/environment/index.js` `api` config section
2. Remove `registerAPI` `./server/app.js` and `./server/app.spec.js` snippets

## API

1. Set `./server/config/environment/index.js` `api` config section
2. Activate `registerAPI` `./server/app.js` and `./server/app.spec.js` snippets

# AppName

1. Set `appName` in `./server/config/environment/index.js` (`appName` and `loggers`)
2. Rename `{name}` for every manifest file (`./*-{name}_manifest.yml`) and rename `[name]` inside
3. Rename `[appName]` in `./sonar-project.properties`: `projectKey` is the git repository name, `projectName` is the humanized app name
4. Rename `appName` in `./package.json` (git repository name)

# Version

1. Set version in `./sonar-project.properties`
2. Set version in `./package.json`

# Swagger

Accessible at ```localhost:4000/_swagger```

Add a description key in your api/action file that will automatically be added to
the swagger.

### BM pipes

```
#!/bin/bash

echo "Dernier tag" > git.version
git describe --always --tags --abbrev=0 --match release-* >> git.version
echo "Dernier commit" >> git.version
git rev-parse HEAD >> git.version

export PATH=/opt/IBM/node-v4.4.5/bin:$PATH
npm install -g npm@3.9.5
npm install

npm run build
RESULT_BUILD=$?
[ $RESULT_BUILD -eq 1 ] && curl -i -X POST -d 'payload={"username":"Build dev", "text": "Build failed"}' https://mattermost.eu-gb.mybluemix.net/hooks/bc5313ihxpgp9ydc1wpr3yn1ba

cp git.version dist/
```

### Environments

Three environments are available by default:
- production (in manifests)
- development (in manifests)
- local (default)

In this boilerplate, route error stack is not displayed in production only (can be overriden by configuration in `app.js` or in models configuration (`stackTrace: false`)).
Loggers configurations depends on NODE_ENV config (can be overriden by config, moving `console: true` to the right env, for instance `console: 'development'`).

### NPM SCRIPTS

Available commands:

```
// helper cmds
npm test // === npm run test but with better npm error handling
npm run test // test client code with karm-sinon-chai and report with karma-istambul
npm run test:server // test application with mocha sinon chai and report coverage via nyc istambul
npm run lint // run eslint throught all code
npm run lint:fix // run eslint and try to automatically fix warnings

// developer cmds
npm run dev // start app with nodemon & webpack watch
npm run prod // start a production like server, you need to build the project first !

// helper cmds
npm run build // generate server files in dist folder ready for production
npm run clean // removes files generated by build and tests

// internal cmds
"prebuild": "npm run clean",
"postbuild": "cp -Rp manifests/* package.json npm-shrinkwrap.json dist",

// external cmds
npm run build // generate all files for production in dist folder
npm start // start production server

```

### Testing

Use `npm test` instead of npm run test if you want a clean output.

In order for the test to pass you need a global coverage of at least 50%.
Expect, sinon and logger variables are available in the global scope if ```NODE_ENV === 'test'```.

Check `./mocha.conf.js` && `./mocha.global.js` for more info about the test setup.

You can toggle coverage feature in package.json via:
```"check-coverage": false || true,```


### Linting

Eslint can automatically fix quit a few warnings and errors by itself if you run `npm run lint:fix`.

### Babel (syntax improvement)

## babel-env

Includes:

- babel preset 2015
    check-es2015-constants
    transform-es2015-arrow-functions
    transform-es2015-block-scoped-functions
    transform-es2015-block-scoping
    transform-es2015-classes
    transform-es2015-computed-properties
    transform-es2015-destructuring
    transform-es2015-duplicate-keys
    transform-es2015-for-of
    transform-es2015-function-name
    transform-es2015-literals
    transform-es2015-modules-commonjs
    transform-es2015-object-super
    transform-es2015-parameters
    transform-es2015-shorthand-properties
    transform-es2015-spread
    transform-es2015-sticky-regex
    transform-es2015-template-literals
    transform-es2015-typeof-symbol
    transform-es2015-unicode-regex
    transform-regenerator

- babel preset 2016
    transform-exponentiation-operator

- babel preset 2017
    syntax-trailing-function-commas
    transform-async-to-generator

## babel-stage-0

Includes:

- babel stage 1
    transform-class-constructor-call (Deprecated)
    transform-export-extensions
- babel stage 2
    syntax-dynamic-import
    transform-class-properties
- babel stage 3
    transform-object-rest-spread
    transform-async-generator-functions
